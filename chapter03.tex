\chapter{Aplicación para el control de la tarjeta}

\section{Introducción}

Desde los inicios de este proyecto lo que se ha pretendido es emplear un sistema de adquisición de señales como un osciloscopio digital. Para ello son necesarios la tarjeta de adquisición y un software que permita al usuario controlar el dispositivo desde una interfaz intuitiva y visualizar los resultados de forma sencilla.


\subsection{Elección del entorno de desarrollo}

El lenguaje o, mejor dicho, plataforma que se ha empleado para el desarrollo de dicho software es \matlab{}, la razón, su inmejorable compatibilidad con el hardware disponible. A partir de ahí, los componentes de \matlab{} que se han empleado para conseguir que el software de control gozase de las características previstas por los objetivos del proyecto son dos: el entorno de desarrollo de interfaces gráficas de usuario (\textsc{gui}) de \matlab{}, más conocido como \textsc{guide} (\emph{graphical user interface development environment}); y el \emph{Data Acquisition Toolbox} de \matlab{}. El primero de ellos se ha empleado para, como su nombre indica, crear la interfaz que comunica el dispositivo con el usuario. Esta comunicación se hace a través del segundo de los componentes mencionados, éste permite, mediante comandos de \matlab{} que pueden incluirse en rutinas o llamarse por separado, manejar el dispositivo ---convocarlo a muestrear, configurar sus propiedades--- y administra automáticamente los resultados almacenándolos en búffers situados en la memoria volátil del ordenador, haciéndolos de este modo accesibles al administrador de la tarjeta.\par % por un espacio de tiempo limitado


\subsection{Funcionamiento de un osciloscopio}

Como se ha mencionado en el punto anterior, el modelo de funcionamiento utilizado como referencia en el desarrollo de la aplicación de control es el de un osciloscopio. Por ello, y en base a las conclusiones extraídas durante la realización de este proyecto, se ha creído conveniente remarcar un aspecto del funcionamiento habitual de cualquier osciloscopio.\par
La mayoría de osciloscopios de propósito general permiten ajustar el eje de tiempos de la ventana en la que se representan las señales monitorizadas, esto conlleva una serie de implicaciones que caracterizan el método con el que estos dispositivos desempeñan su propósito. En primer lugar, lejos de representar las muestras por pantalla al mismo ritmo con el que se muestrea, éstas se almacenan en un búffer. En principio, cuando el búffer dispusiese de muestras suficientes para cubrir el eje temporal seleccionado, podría representarse su contenido en pantalla. No obstante, estos dispositivos acostumbran a pre"=procesar las señales digitalizadas antes de representarlas en el monitor con objeto de mostrar una información de la mayor calidad posible\footnote{En la mayoría de dispositivos es posible disparar la señal para que las transiciones a través de determinados niveles de umbral aparezcan centradas en los ejes de la ventana, además suele eliminarse la componente en continua de las señales representadas y se deja al usuario la posibilidad de incluir algún tipo de offset}. El procesado requiere de un periodo de tiempo añadido al necesario para recopilar las muestras y, en la mayoría de los casos, muestras adicionales a las que requiere el tamaño de la ventana, lo que impide que la representación se realice en tiempo real. Más aún, en general se persigue que la tasa de refresco del monitor de un osciloscopio sea suficiente para que el ojo perciba una variación continua, la necesidad de tiempo adicional para recoger nuevas muestras y llevar a cabo el procesado puede comprometer este objetivo.\par

En la actualidad suelen emplearse osciloscopios digitales, éstos a diferencia de sus análogos analógicos no realizan una representación de la señal en tiempo real. En su lugar, digitalizan las señales analógicas a su entrada y almacenan las señales digitales resultantes en una memoria intermedia. Antes de representar una señal digital, esta se somete a un procesado digital el cual permite la implementación de nuevas funciones en el osciloscopio, como por ejemplo las siguientes:

\begin{itemize}
	\item Se elimina la componente en continua de las señales permitiendo al usuario manipular un offset de amplitud. De esta forma es posible modificar la posición en la que aparecen representadas las señales pudiendo desplazarlas a lo largo del eje vertical de la representación. Esto posibilita una comparación más precisa entre varias señales.
	\item Es posible obtener información de la señal como amplitud de pico a pico o frecuencia que puede representarse junto a la señal si se configura el osciloscopio a tal efecto.
	\item Los ejes, de amplitudes y temporal, de la representación pueden ajustarse. El primero para modificar la amplitud de la representación de la señal permitiendo por ejemplo que esta se ajuste lo máximo posible a los extremos superior e inferior de la ventana, y el segundo para que en el monitor del osciloscopio se muestre una porción de la señal de mayor duración.
	\item Los ejes horizontal y vertical de la ventana
		Puede modificarse el rango
	\item Centrar en triggers
\end{itemize}<++>
Una sola causa, sistema digital, procesado digital, requiere que todas las muestras que vayan a representarse estén antes en memoria para que puedan procesarse. Además como el objeto de este procesado es entre otras cosas centrar las transiciones que la señal realiza sobre un determinado umbral en los ejes de la ventana, es necesario desplazar la señal en el eje de tiempos y, por tanto, se necesita en memoria un trozo de señal más largo.
Eje de tiempos ajustable más tasa de refresco suficiente para engañar al ojo humano igual a que el eje de tiempos es tan grande a veces que no se puede engañar al ojo humano independientemente de la potencia del osciloscopio

La tasa de refresco del monitor de un osciloscopio se diseña para que los datos que aparecen en pantalla cambien lo suficientemente rápido como para que el ojo humano experimente una variación continua. Esto significa que las muestras obtenidas de una señal no aparecen por pantalla al mismo ritmo con el que se muestrea, al contrario, la señal muestreada se va almacenando en un búffer hasta transcurrido un periodo de tiempo tras el cual se procesa y se muestra en el monitor del osciloscopio. Ese periodo de tiempo, prácticamente igual al periodo de refresco del osciloscopio,
% Podría separar las cosas en puntos distintos. Por una parte introducción hasta el punto anterior a hablar de matlab. Luego elección de matlab y componentes utilizados y por último funcionamiento de un osciloscopio.
% La cosa está así: Para desarrollar el software de control me he fijado en un osciloscopio. En base a las conclusiones que he sacado mientras programaba he creído conveniente explicar por encima un aspecto importante del funcionamiento de un osciloscopio. Al muestrear, no sólo las muestras de una señal no aparecen por pantalla en tiempo real, si no que parte de ellas se descartan y ni siquiera llegan a mostrarse.
% Antes de eso incluso debería hablar del eje de tiempos de la ventana de un osciloscopio. Decir de él que es configurable, que para representar es necesario tener almacenadas en el búffer al menos muestras suficientes para cubrir dicho eje de tiempos (un periodo de tiempo equivalente al mostrado por el eje). Aún más, puesto que el osciloscopio representa una señal centrada en disparos y es inevitable que después de procesar se descarten muestras.
% Se refresca el monitor no cuando se muestrea, si no con una frecuencia suficiente para engañar al ojo humano. Se aprovecha la lentitud del ojo humano para procesar las muestras y presentar los resultados de forma conveniente, centrados en un trigger etc. Esto significa que \ldots. La frecuencia con la que se refresca la imagen está fuertemente relacionada con la amplitud temporal seleccionada
% Tengo que poner énfasis en el hecho de que la configuración del tamaño de ventana hace que el osciloscopio se comporte de una forma distinta, procesando la información antes de salir por pantalla o sacando datos sin más
Para ello se limita la cantidad de datos que se almacena en los búffers de entrada y se procesa antes de mostrar por pantalla.
